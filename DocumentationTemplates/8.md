### Loops

[Go back](#htvm-documentation)

### **Understanding Loops in HTVM**

HTVM supports multiple types of loops, inspired by AutoHotKey (AHK) syntax. These loops are designed to be simple and efficient, offering flexibility for various tasks. Let’s explore the **Regular Loop**, **Loop Parse**, **Infinite Loop**, and the **while loop**.

**Regular Loop** = `%%%doc_keyWordLoop%%%`

**Loop Parse** = `%%%doc_keyWordLoopParse%%%`

**Infinite Loop** = `%%%doc_keyWordLoopInfinite%%%`

**While loop** = `%%%doc_keyWordWhileLoop%%%`

**continue** = `%%%doc_keyWordContinue%%%`

**break** = `%%%doc_keyWordBreak%%%`

**A_Index** = `%%%doc_keyWordAIndex%%%`

**A_LoopField** = `%%%doc_keyWordALoopField%%%`


### **1. Regular Loop**

The `%%%doc_keyWordLoop%%%` keyword in HTVM is the simplest and most common type of loop. It runs a specified number of iterations, and you can use the `%%%doc_keyWordAIndex%%%` keyword to track the current iteration number.

#### Example:

```htvm
%%%htvmSnippet38%%%

```

In this loop, `%%%doc_keyWordAIndex%%%` is used to track the current iteration number. The `%%%doc_keyWordContinue%%%` keyword is used to skip even numbers, so only odd numbers will be printed.

---

### **2. Loop Parse**

The `%%%doc_keyWordLoopParse%%%` is similar to AutoHotKey’s loop parsing method, where you can iterate over a string or text with different delimiters. In HTVM, `%%%doc_keyWordALoopField%%%` is used to access the current field (or token) in the string being parsed.

#### **Example 1: Delimited by Space (" ")**

```htvm
%%%htvmSnippet39%%%

```

In this example, the loop iterates over each word in the string `someText`, which is delimited by spaces. The `%%%doc_keyWordALoopField%%%` holds the current word from the string.

#### **Example 2: Delimited by New Line**

```htvm
%%%htvmSnippet40%%%

```

Here, the loop splits the text by new lines, and `%%%doc_keyWordALoopField%%%` holds each line individually.

#### **Example 3: Delimited by Carriage Return**

```htvm
%%%htvmSnippet41%%%

```

In this case, the text is delimited by carriage returns, and each line is printed separately.

#### **Example 4: Delimited by Both Space and New Line**

```htvm
%%%htvmSnippet42%%%

```

This example uses both a space and a new line as delimiters to split the string into tokens.

#### **Example 5: No delimited**

```htvm
%%%htvmSnippet43%%%

```

This example uses no delimiters to parse each character.

---

### **3. Infinite Loop**

HTVM also supports infinite loops using the `%%%doc_keyWordLoopInfinite%%%` keyword without a defined number of iterations. The loop will continue running until a `%%%doc_keyWordBreak%%%` condition or manual termination occurs. The `%%%doc_keyWordContinue%%%` keyword can be used inside the infinite loop to skip the current iteration and continue with the next one.

#### Example (Infinite Loop):

```htvm
%%%htvmSnippet44%%%

```

Here, the loop runs indefinitely, printing the current value of `%%%doc_keyWordAIndex%%%`. When `%%%doc_keyWordAIndex%%%` reaches 5, the loop breaks. You can also use `%%%doc_keyWordContinue%%%` to skip iterations as needed.

---

### **4. While Loop**

The `%%%doc_keyWordWhileLoop%%%` loop in HTVM works like a typical while loop in other languages. It continues to execute the loop body as long as the specified condition evaluates to true.

#### Example (While Loop):

```htvm
%%%htvmSnippet45%%%

```

In this example, the `%%%doc_keyWordWhileLoop%%%` loop runs once because the condition is initially true, then changes `var1` to true, causing the loop to terminate.

---

### **Array Example in Loop**

HTVM also allows arrays, which can be used in loops for more complex tasks. Here’s an example that iterates over an array:

```htvm
%%%htvmSnippet46%%%

```

In this case, the loop iterates through each element of the array `arr123` using `%%%doc_keyWordAIndex%%%` to reference the array's index.

---

### **Variable Example in Loop**

With HTVM, you can also use variables to control loops. Here's an example:

```htvm
%%%htvmSnippet47%%%

```

This example shows how HTVM allows you to use variables like `var1` to control the number of iterations in the loop, with `%%%doc_keyWordAIndex%%%` printing the current iteration number.

---

### **Key Notes:**
- **`%%%doc_keyWordAIndex%%%`**: Used in all loops except for `%%%doc_keyWordWhileLoop%%%` loops.
- **`%%%doc_keyWordALoopField%%%`**: Used only in `%%%doc_keyWordLoopParse%%%` to reference the current field.
- **`%%%doc_keyWordContinue%%%`**: Can be used in any loop to skip the current iteration and continue with the next one. When converting to Lua, place the `::%%%doc_keyWordContinue%%%` at the end of the loop, just before it ends.

---

### **Lua Conversion**

For the **%%%doc_keyWordLoop%%%**, **%%%doc_keyWordLoopParse%%%**, and **%%%doc_keyWordLoopInfinite%%%** types, the Lua conversion looks like this:

```htvm
%%%htvmSnippet48%%%

```

In Lua, the conversion for these loops would use the `goto` statement to achieve the continue behavior. Here's how it would look in Lua:

```lua
function infinite_HTVM_Lua_Loop_HTVM()
    local i = 0
    return function()
        i = i + 1
        return i
    end
end

function LoopParseFunc(varString, delimiter1, delimiter2)
    local items = {}
    delimiter1 = delimiter1 or ""
    delimiter2 = delimiter2 or ""
    -- Changed: Don't escape the delimiters since we want them literal
    -- Just use them directly in the pattern
    if delimiter1 == "" and delimiter2 == "" then
        for i = 1, #varString do
            table.insert(items, varString:sub(i, i))
        end
    else
        -- Changed: Simplified pattern to directly match \n and \r
        local pattern = delimiter1 .. delimiter2
        for item in varString:gmatch("([^" .. pattern .. "]+)") do
            table.insert(items, item)
        end
    end
    return items
end

-- Regular loop example
for A_Index1 = 0 + 1 , 10 + 0 do
    if (A_Index1 % 2 == 0) then
        goto continue0
    end
    -- Output only odd numbers from 1 to 9
    print(A_Index1)
    ::continue0::
end

print("=====================")

-- Infinite loop example
for A_Index2 in infinite_HTVM_Lua_Loop_HTVM() do
    if (A_Index2 % 2 == 0) then
        goto continue1
    end
    -- Output only odd numbers from 1 to 9
    print(A_Index2)
    if (A_Index2 == 9) then
        break
    end
    ::continue1::
end

print("=====================")

-- Loop, Parse loop example
var1 = "hello whats up bro how are you doing"
items3 = LoopParseFunc(var1, " ")
for A_Index3 , A_LoopField3 in ipairs(items3) do
    A_LoopField3 = items3[A_Index3 - 0]
    if (A_LoopField3 == "bro") then
        goto continue2
    end
    -- 3 will never print
    print(A_Index3)
    ::continue2::
end
```

This approach with `::%%%doc_keyWordContinue%%%` is used only for the 3 types of loops but NOT the `%%%doc_keyWordWhileLoop%%%` loop.

> **Note:** Lua does not support a native `continue` statement. To mimic this behavior, we use a labeled `goto`—specifically `goto continue`—followed by a `::continue::` label at the end of the loop.  
> This approach is **only required when converting to Lua**. If you're using HTVM with JavaScript, Python etc... as the target language, there's **no need to write or worry about `::continue`**—it's automatically ignored or excluded in those environments.

---

### **Conclusion**

In HTVM, we have three main types of loops:

1. **Regular Loop** - `%%%doc_keyWordLoop%%%` - Simple iteration over a specified number of times.
2. **Loop Parse** - `%%%doc_keyWordLoopParse%%%` - Iterates over fields in a string or text, with customizable delimiters.
3. **Infinite Loop** - `%%%doc_keyWordLoopInfinite%%%` - A loop that runs indefinitely until broken manually or a condition is met.
4. **While Loop** - `%%%doc_keyWordWhileLoop%%%` - A standard loop that runs while a condition is true.

Each of these loops is intuitive and makes it easy to handle a variety of looping needs. Make sure to use `%%%doc_keyWordAIndex%%%` and `%%%doc_keyWordALoopField%%%` where appropriate, and use the `%%%doc_keyWordContinue%%%` keyword to control loop flow. When converting to Lua, remember to add `::%%%doc_keyWordContinue%%%` just before the loop ends.

---