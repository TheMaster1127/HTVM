### GUI (Graphical User Interface with HTVM)

[Go back](#htvm-documentation)

**⚠️ Language Limitation: JavaScript Only**

The GUI feature in HTVM allows for the creation of graphical user interfaces specifically for **web browsers (JavaScript)**. It generates the necessary HTML and JavaScript code. It **does not** support creating native GUIs for Python, C++, or other desktop environments. Using these commands when targeting non-JS languages will not work.

HTVM's GUI system lets you build interfaces with elements like buttons, text, edit fields, pictures, and more, using a simplified, flexible syntax designed for efficiency and fewer keystrokes. HTVM handles the basic HTML page setup implicitly when GUI commands are present.

### GUI Commands

HTVM uses two primary commands for building GUIs: `gui` for creating elements and containers, and `guicontrol` for modifying existing elements.

#### `gui` Command

This command is used to **add new elements** (like buttons, text) or **create container `div`s** to organize your layout.

**Syntax:**

```htvm
%%%doc_keyWordComment%%% Create a container (div) - Options separated by spaces OR commas
gui [Option1:Value1] [Option2:Value2] ...
gui [Option1:Value1],[Option2:Value2],...

%%%doc_keyWordComment%%% Add a specific control element - ElementType followed by space/comma separated options
gui &lt;ElementType&gt; [Option1:Value1] [Option2:Value2] ...
gui &lt;ElementType&gt;,[Option1:Value1],[Option2:Value2],...
```

*   **`&lt;ElementType&gt;`**: Specifies the type of control to add (e.g., `button`, `text`, `edit`). If omitted, a container (`div`) is created.
*   **`[Options...]`**: A series of options defining the element's properties. **Options can be separated by SPACES or COMMAS.**

**Option Flexibility:**

1.  **Separators**: Options can be separated by **SPACES** or **COMMAS**. You can mix them.

```htvm
%%%doc_keyWordComment%%% Space separated is often cleaner also different style of defining values
gui button x:50 y100 w"200px" h:"30px"
%%%doc_keyWordComment%%% Comma separated also works
gui button,x:"50px",y:"100px",w:"200px",h:"30px"
```

2.  **Key-Value Format**: Use `key:value` or single-letter prefixes `kvalue`. Many aliases exist (see [Options & Aliases](#options--aliases)).
3.  **Case Insensitivity**: Option *keys* and element types are case-insensitive. Option *values* (like IDs, text content, callback names) are case-sensitive.
4.  **`add` Keyword**: Optional and ignored (`gui add button` is the same as `gui button`).
5.  **Grouping**: Options can span multiple lines using `{...}`, `[...]`, or `(...)` for readability. Separator rules (spaces or commas) still apply inside the group.

```htvm
%%%doc_keyWordComment%%% Single line with spaces
gui button x:"10px" y:"10px" w:"100px" h:"30px" id:"myBtn" callback:MyAction value:"Click"

%%%doc_keyWordComment%%% Multi-line grouping (using spaces within the lines)
gui button {
    x:"10px" y:"10px"
    width:"100px" height:"30px"
    id:"myBtn"
    callback:MyAction
    value:"Click"
}
```

**Parenting & Default Container:**

*   Every element belongs inside a container.
*   If no `parentId` is specified when using the `gui` command to create an element, it is placed in the default background container (internally referred to as `div0`).
*   To place an element inside *your* custom container (e.g., one created with `gui id:"myPanel" ...`), you **must** use the `parentId:"myPanel"` option on the element being created.

#### `guicontrol` Command

Modifies properties of an **existing** GUI element.

**Syntax:**

```htvm
%%%doc_keyWordComment%%% Single line modification
guicontrol [Option1:Value1] [Option2:Value2] ...
guicontrol [Option1:Value1],[Option2:Value2],...

%%%doc_keyWordComment%%% Multi-line modification using flexible grouping (), [], or {}
guicontrol (
    Option1:Value1
    Option2:Value2
    ...
)
```

*   **`[Options...]`**: **SPACE or COMMA-SEPARATED** options.
    *   **MUST** include `id:&lt;element_id&gt;` (e.g., `id:"myButton"`) to target the element.
    *   **`parentId` Requirement (CRITICAL CLARIFICATION):**
        *   **Case 1: No Custom Containers Created:** If your entire script **only** adds elements directly to the background (never using `gui { id:"..." ... }` to create a custom container), then `parentId` is **optional** for `guicontrol`. HTVM will assume the target element is on the default background (`div0`).
        *   **Case 2: Custom Containers Exist:** As soon as you create **even one** custom container using `gui { id:"..." ... }`, the `parentId` option becomes **mandatory** for **all** `guicontrol` commands to avoid ambiguity.
            *   To target an element **inside** a custom container: Use `parentId:"containerId"`.
            *   To target an element that is still on the **default background** (or a top-level container itself): Don't use `parentId:"..."`.
    *   Other options specify the changes (e.g., `value:"NewText"`, `isVisible:false`).

**Mapping HTH Actions to HTVM Options (using `guicontrol`):**

*   **Move/Resize**: Use `x:`, `y:`, `width:`, `height:` options with pre-formatted string values (e.g., `x:varX_px`).
*   **Text**: Use `value:` (e.g., `guicontrol id:"myLabel",value:"New Text"`).
*   **Picture**: Use `value:` with a new URL (e.g., `guicontrol id:"myImage",value:"http://new.url/img.png"`).
*   **Hide/Show**: Use `isVisible:false` or `isVisible:true`.
*   **Enable/Disable**: Use `isEnabled:false` or `isEnabled:true`.
*   **Destroy**: Use `isDeleting:true`.
*   **Font**: Use `size:` for font size (e.g., `size:16`) and `color:` for text color (e.g., `color:"#FF0000"`). Use `rawCss:` for font family (e.g., `rawCss:"font-family:Courier;"`).

#### Multiple GUI Windows (`num:` prefix - *NOT SUPPORTED*)

HTVM **does not** use HTH's `Gui 2:`, `Gui 3:` syntax. Simulate multiple areas by:
1.  Creating container `div`s: `gui id:"window1",...`, `gui id:"window2",...`
2.  Placing elements inside using `parentId:"window1"` or `parentId:"window2"`.
3.  Toggling visibility using `guicontrol id:"window1",isVisible:false` etc.

### GUI Elements (Controls)

Add elements using `gui &lt;ElementType&gt; [Options...]`:

| Element Type | Description                                     | Default ID Format | Default Callback Format | Notes                                                                           |
| :----------- | :---------------------------------------------- | :---------------- | :---------------------- | :------------------------------------------------------------------------------ |
| `button`     | Clickable button                                | `button` + Counter  | `Button` + Counter      |                                                                                 |
| `text`       | Static text label                               | `text` + Counter    | `Text` + Counter        |                                                                                 |
| `edit`       | Text input field                                | `edit` + Counter    | `Edit` + Counter        | Use callback + global var/OSP struct to get value.                              |
| `picture`    | Image display (`&lt;img&gt;`)                         | `picture` + Counter | `Picture` + Counter     | `value` is URL. Local paths *not* auto-encoded.                               |
| `toggle`     | Checkbox / Switch                               | `toggle` + Counter  | `Toggle` + Counter      | `value` is `true`/`false`. `A_Value` in callback is boolean.                    |
| `rectangle`  | Colored rectangle (`&lt;div&gt;`)                     | `rectangle` + Counter | `Rectangle` + Counter | Use `backgroundColor`.                                                        |
| `circle`     | Colored circle (`&lt;div&gt;` + round border)         | `circle` + Counter  | `Circle` + Counter      | Use `backgroundColor`.                                                        |
| `video`      | Video player (`&lt;video&gt;`)                        | `video` + Counter   | `Video` + Counter       | `value` is URL (video file or YouTube embed).                                 |
| `dropdown`   | Select dropdown (`&lt;select&gt;`)                    | `dropdown` + Counter| `Dropdown` + Counter    | `value` is pipe separated options. **element1&#124;element2&#124;element3** |
| `iframe`     | Embed external content (`&lt;iframe&gt;`)             | `iframe` + Counter  | `Iframe` + Counter      | `value` is URL.                                                               |

(Counters start at 0 for each type, e.g., `button0`, `Button0`, `edit0`, `Edit0`...)

#### Exmaple:

```htvm
%%%htvmSnippet50%%%

```

### Options & Aliases 


Configure elements using **SPACE or COMMA-SEPARATED** options.

**Key Rules:**

1.  **Separators**: Use Spaces or Commas between options (`x:"10px" y:"10px"` or `x:"10px",y:"10px"`).
2.  **No Spaces in Direct Values**: Store values like `var1 + var2` in a variable (`str hw := var1 + var2`) and use `value:hw`.
3.  **Quote Literal IDs/ParentIDs**: Use quotes for string literals (`id:"myId"`). Do not quote variables (`id:myIdVar`).
4.  **Pre-concatenate Units**: For `x`, `y`, `width`, `height`, prepare string variables including `px` or `%` **before** using them in the command (e.g., `str width_px := myWidth . "px"`, then use `width:width_px`).
5.  **Case Sensitivity**: Keys/aliases/types are case-insensitive; values are case-sensitive.

**Common Options Table:**

| Canonical JS      | Purpose                     | Single-Letter Prefix | Colon Aliases (Examples)                    | Notes                                                                 |
| :---------------- | :-------------------------- | :------------------- | :------------------------------------------ | :-------------------------------------------------------------------- |
| `id`              | Unique Element Identifier   | `i`, `v`             | `id`, `elementId`, `eid`                    | String. **Quote if literal.** Defaults if omitted.                    |
| `parentId`        | ID of Container Element     | `p`                  | `parentId`, `pid`, `divId`                  | String. Defaults to `"div0"`. **Quote if literal.**                   |
| `x`               | Horizontal Position         | `x`                  | `x`, `xPos`, `xCoord`                       | **String var required (e.g., `myVarX_px`).** Supports `px` or `%`.    |
| `y`               | Vertical Position           | `y`                  | `y`, `yPos`, `yCoord`                       | **String var required (e.g., `myVarY_px`).** Supports `px` or `%`.    |
| `width`           | Element Width               | `w`                  | `width`, `wight`, `widh`                    | **String var required (e.g., `myVarW_px`).** Supports `px` or `%`.    |
| `height`          | Element Height              | `h`                  | `height`, `hight`, `heigth`                 | **String var required (e.g., `myVarH_px`).** Supports `px` or `%`.    |
| `zIndex`          | Stacking Order              | `z`                  | `zIndex`, `z-index`                         | Integer.                                                              |
| `value`           | Content/State             | `d`                  | `value`, `val`, `displayValue`              | Text/URL/Bool/Options. **Use variable for spaces/commas.**          |
| `placeholder`     | Placeholder text for Edit | `q`                  | `placeholder`, `plc`, `ph`, `grayText`      | String. **Use variable for spaces.**                                  |
| `callback`        | Function on Interaction     | `g`, `f`             | `callback`, `func`, `fn`, `call`            | String (HTVM Label Name). Defaults if omitted.                        |
| `backgroundColor` | Background Color            | `o`                  | `backgroundColor`, `bgColor`, `bg`, `bgc` | String (`"red"`, `"#FF0000"`). Auto-adds `#` for hex.                 |
| `color`           | Text/Foreground Color       | `c`                  | `color`, `clr`                              | String (`"blue"`, `"#00F"`). Auto-adds `#` for hex.                 |
| `rounding`        | Corner Rounding (px)        | `r`                  | `rounding`, `round`, `rnd`                  | Integer (pixels).                                                     |
| `border`          | Element Border              | `b`                  | `border`, `boder`, `outline`                | String (CSS syntax). **Use var for spaces.**                          |
| `rawCss`          | Additional CSS Styles       | `l`                  | `rawCss`, `css`, `style`, `luxury`          | String (CSS rules). **Use var for multiple.**                         |
| `size`            | Font Size (px)              | `s`                  | `size`, `sz`                                | Integer (pixels).                                                     |
| `isEnabled`       | Enable/Disable Interaction  | `a`                  | `isEnabled`, `isEnb`                        | Boolean (`true`/`false`).                                             |
| `isVisible`       | Show/Hide Element           | `u`                  | `isVisible`, `isVsb`                        | Boolean (`true`/`false`).                                             |
| `isDeleting`      | Remove Element from GUI   | `n`                  | `isDeleting`, `del`, `remove`, `rm`         | Boolean (`true`). Use with `guicontrol`.                              |

*(See HTVM source (`guiParserStep4`) for a full alias list.)*

#### Exmaple:

```htvm
%%%htvmSnippet51%%%

```

### Callbacks and State Management

Callbacks connect GUI events to HTVM logic (labels ending in `subout`). Logic **must start on the line AFTER the label**, not on the same line. Use `await` before functions like `MsgBox` that return Promises in JavaScript.

**Managing State (Input Example):**

To retrieve data entered by the user (e.g., in an `edit` field), store the data from the input's callback (`A_Value`) into a shared state, typically using global variables or an OSP struct. Using an OSP `struct` is often better for organization, but global variables work too.

**Getting Input Example (using OSP Struct - Recommended):**

```htvm
%%%htvmSnippet52%%%

```

**Callback Parameters:** `A_Id`, `A_Value`, `A_Event` provide context within the callback label.

### Examples

*(Using space separation, pre-concatenated units, OSP struct for state where beneficial, correct callback formatting, and await for MsgBox)*

**Example 1: Simple Input and Button (using OSP Struct)**

```htvm
%%%htvmSnippet53%%%

```

**Example 2: Sized Container (Hardcoded)**

```htvm
%%%htvmSnippet54%%%

```

**Example 3: Button Grid using Loops (Using A_Id)**

```htvm
%%%htvmSnippet55%%%

```

**Example 4: Toggle, Dropdown, Picture Update (using OSP Struct)**

```htvm
%%%htvmSnippet56%%%

```

**Example 5: Using `rawCss` for Styling**

```htvm
%%%htvmSnippet57%%%

```

**Example 6: HTVM Simulated Numeric Adjuster Using Buttons and Input Field (0–100 Range)**

```htvm
%%%htvmSnippet58%%%

```

**Example 7: `Tic-tac-toe`**

```htvm
%%%htvmSnippet59%%%

```

### Summary

HTVM's GUI system offers a simplified yet powerful way to build graphical user interfaces directly within your HTVM code, targeting **JavaScript web environments**. By using the intuitive `gui` command to define elements and containers, and `guicontrol` to modify them dynamically, you can build interactive web applications. The system leverages flexible option syntax (spaces, commas, shorthand, multi-line grouping) and automatically handles underlying HTML/CSS/JS generation, adhering to HTVM's philosophy of **reducing keystrokes and complexity**. Understanding the conditional requirement for `parentId` in `guicontrol` (it's only optional if no custom containers are defined) is key to correctly manipulating elements.

The `gui` and `guicontrol` features allows developers to focus on interface logic and layout using their custom HTVM syntax, bridging the gap between high-level design and functional web UIs.

---