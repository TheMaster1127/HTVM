<!DOCTYPE html>
<html>
<head>
  <title>HTVM IDE</title>
  <link rel="icon" href="img/favicon.webp" type="image/png">
  <style>
    :root {
      --bg-color: #1a1a1a;
      --text-color: #e0e0e0;
      --sidebar-bg: #2d2d2d;
      --hover-bg: #404040;
      --btn-bg: #fe6619;
      --btn-hover: #e65a00;
      --splitter-bg: #555;
    }
    * {
      box-sizing: border-box;
    }
    html, body {
      height: 100%;
      margin: 0;
    }
    body {
      background-color: var(--bg-color);
      color: var(--text-color);
      font-family: Arial, sans-serif;
      display: flex;
      overflow: hidden;
    }
    /* Sidebar */
    #sidebar {
      width: 250px;
      min-width: 150px;
      background-color: var(--sidebar-bg);
      padding: 10px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
    }
    #path-display {
      margin-bottom: 5px;
      font-size: 0.9em;
      color: #ccc;
    }
    #file-path-display {
      margin-bottom: 10px;
      font-size: 0.85em;
      color: #aaa;
    }
    #sidebar-splitter {
      width: 5px;
      background-color: var(--splitter-bg);
      cursor: ew-resize;
    }
    /* Main Content Area */
    #main-content {
      flex: 1;
      display: flex;
      overflow: hidden;
    }
    /* IDE Column (Editor & Console) */
    #ide-container {
      display: flex;
      flex-direction: column;
      overflow: hidden;
      width: 99%;
      min-width: 20%;
    }
    #buttons-container {
      padding: 5px;
      background: var(--bg-color);
    }
    /* Editor (top half of IDE) */
    #editor {
      height: 58.5%;
      border: 1px solid var(--hover-bg);
      overflow: auto;
      display: none;
    }
    /* Horizontal splitter between editor and console */
    #ide-horizontal-splitter {
      height: 5px;
      background-color: var(--splitter-bg);
      cursor: ns-resize;
    }
    /* Console container: flex:1 fills remaining space */
    #console {
      flex: 1;
      position: relative;
      background-color: #000;
      color: #0f0;
      font-family: monospace;
      font-size: 14px;
      padding: 10px;
      overflow: hidden;
    }
    /* Scrollable log area */
    #console-log {
      overflow-y: auto;
      height: 100%;
      padding-right: 40px; /* extra space for clear button */
    }
    /* Clear button fixed at bottom-right */
    #clear-console-btn {
      position: absolute;
      bottom: 5px;
      right: 5px;
      background-color: var(--btn-bg);
      color: white;
      border: none;
      padding: 4px 8px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 12px;
      z-index: 10;
    }
    #clear-console-btn:hover {
      background-color: var(--btn-hover);
    }
    /* Vertical splitter between IDE and Output */
    #vertical-splitter {
      width: 5px;
      background-color: var(--splitter-bg);
      cursor: ew-resize;
      display: none;
    }
    /* Output Column (only visible for HTML files) */
    #output-container {
      width: 80%;
      min-width: 50%;
      display: none;
      flex-direction: column;
      overflow: auto;
      border-left: 1px solid var(--hover-bg);
      padding: 5px;
    }
    /* The HTML output iframe */
    #html-output {
      width: 100%;
      height: 100%;
      border: none;
    }
    #close-iframe-btn {
      background-color: var(--btn-bg);
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 4px;
      cursor: pointer;
      margin-top: 5px;
    }
    #close-iframe-btn:hover {
      background-color: var(--btn-hover);
    }
    
    
    /* Toggle Switch CSS */
    .toggle-switch {
      position: relative;
      display: inline-block;
      width: 60px;
      height: 25px;
      top: -5px; /* Move the element up by 5 pixels */
    }
    
    .toggle-switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }
    
    .toggle-switch .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #ccc;
      transition: 0.4s;
      border-radius: 24px;
    }
    
    .toggle-switch .slider:before {
      position: absolute;
      content: "";
      height: 23px;
      width: 23px;
      border-radius: 50%;
      left: 4px;
      bottom: 1px;
      background-color: white;
      transition: 0.4s;
    }
    
    input:checked + .slider {
      background-color: #4CAF50;
    }
    
    input:checked + .slider:before {
      transform: translateX(26px);
    }
    

    /* Sidebar items */
    .item {
      padding: 8px;
      margin: 4px 0;
      display: flex;
      align-items: center;
      border-radius: 4px;
      transition: background-color 0.2s;
    }
    .item:hover {
      background-color: var(--hover-bg);
    }
    .folder::before {
      content: 'üìÅ ';
      margin-right: 5px;
    }
    .file::before {
      content: 'üìÑ ';
      margin-right: 5px;
    }
    .item span.name {
      flex: 1;
      cursor: pointer;
    }
    .item button.action-btn {
      background: transparent;
      border: none;
      color: #aaa;
      cursor: pointer;
      margin-left: 4px;
      font-size: 16px;
    }
    .item button.action-btn:hover {
      color: #fff;
    }
    /* Common button styling */
    button {
      background-color: var(--btn-bg);
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 4px;
      cursor: pointer;
      margin: 5px 5px 5px 0;
    }
    button:hover {
      background-color: var(--btn-hover);
    }
    button:disabled {
      background-color: #333;
      cursor: not-allowed;
    }
  </style>
  

 
<!-- Load Ace Editor core -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/ace.js"></script>


<!-- Load the language tools extension -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/ext-language_tools.js"></script>

  <!-- HTVM syntax -->  
  <script src="htvm_completions.js"></script>
  <script src="htvm-mode.js"></script>

  <!-- HTVM transpiler in js -->
  <script src="../HTVM.js"></script>
</head>
<body>
  <!-- Sidebar -->
  <div id="sidebar">
    <div id="path-display"></div>
    <div id="file-path-display"></div>
    <button id="back-btn" onclick="goBack()" disabled>‚Üê Back</button>
    <div id="directory-contents"></div>
  </div>
  <div id="sidebar-splitter"></div>
  <!-- Main Content Area -->
  <div id="main-content">
    <!-- IDE Column (Editor & Console) -->
    <div id="ide-container">
      <div id="buttons-container">
        <button onclick="createNew('file')">New File</button>
        <button onclick="createNew('folder')">New Folder</button>
        <button onclick="runFile()" id="run-btn">Run (Ctrl+Enter)</button>
        <button onclick="closeIframe()" id="close-iframe-btn">Close Iframe html</button>
        <label class="toggle-switch">
          <input type="checkbox" id="runJsAfterHTVM">
          <span class="slider"></span>
        </label>
          <span>Run JS after HTVM Conversion</span>
      </div>
      <div id="editor"></div>
      <div id="ide-horizontal-splitter"></div>
      <div id="console">
        <div id="console-log">
          <!-- Log output goes here -->
        </div>
        <button id="clear-console-btn" onclick="clearConsole()">Clear</button>
      </div>
    </div>
    <!-- Vertical Splitter between IDE and Output -->
    <div id="vertical-splitter"></div>
    <!-- Output Column (visible only for HTML files) -->
    <div id="output-container">
      <iframe id="html-output"></iframe>
      <button onclick="closeIframe()" id="close-iframe-btn">Close Output</button>
    </div>
  </div>

  <script>

 
// Get the saved value from localStorage; default to 'true' if not set
let runJsAfterHTVM = localStorage.getItem('runJsAfterHTVM');

// If the value is null (never set), default to 'true' and save it
if (runJsAfterHTVM === null) {
    runJsAfterHTVM = 'true';
    localStorage.setItem('runJsAfterHTVM', runJsAfterHTVM);
}

// Convert the string to a boolean
runJsAfterHTVM = runJsAfterHTVM === 'true';

// Set the checkbox based on the stored value
document.getElementById('runJsAfterHTVM').checked = runJsAfterHTVM;

// Function to handle toggle change
document.getElementById('runJsAfterHTVM').addEventListener('change', function() {
    runJsAfterHTVM = this.checked;
    localStorage.setItem('runJsAfterHTVM', runJsAfterHTVM ? 'true' : 'false'); // Save as string
    console.log("Run JS after HTVM conversion: " + runJsAfterHTVM);
});




  
let build_in_funcs = '';
let allInstFormGithub = "";
function fetchBuildInFuncs() {
    // Fetch the HTVM-instructions.txt file from the URL
    fetch('https://raw.githubusercontent.com/TheMaster1127/HTVM/refs/heads/main/HTVM-instructions.txt')
        .then(response => response.text())  // Get the raw text of the file
        .then(data => {
            // Split the text into an array of lines
            const lines = data.split('\n');
            let allInstFormGithub = "";
            allInstFormGithub = String(data);
            localStorage.setItem('allInstFromGithubFIX', allInstFormGithub);
            

            // Extract the lines from 163 to the end (index 162 to the end of the array)
            build_in_funcs = lines.slice(162).join('\n');
            
            // You now have the build_in_funcs variable populated with lines from 163 to the end
            //console.log(build_in_funcs);  // Optionally print the result to check
        })
        .catch(error => {
            console.error('Error fetching HTVM-instructions.txt:', error);
        });
}

// Call the function to fetch the data
fetchBuildInFuncs();

  // Utility function to simulate sleep/delay
function sleep(ms) {
    return new Promise(resolve => setTimeout(resolve, ms));
}
  
    /* ----------------------------
       Utility & Persistence Setup
    ----------------------------- */
    function getUrlParam(param) {
      let params = new URLSearchParams(window.location.search);
      return params.get(param);
    }

let urlParams = new URLSearchParams(window.location.search);
let id = urlParams.get('id');

if (id) {
    const storedData = localStorage.getItem(`htvm_lang_${id}`);

    if (storedData) {
        try {
            const dataArray = JSON.parse(storedData);

            if (Array.isArray(dataArray)) {
                // Replace the first element with "htvm" and join the rest of the trimmed lines
                dataArray[0] = "htvm2";  // Replace the first line with "htvm"
                dataArray[1] = "htvm2";  // Replace the first line with "htvm"
                const finalText = dataArray.map(line => line.trim()).join("\n");

                argHTVMinstrMORE.push(finalText);
            } else {
                console.error("Stored data is not an array:", dataArray);
            }
        } catch (error) {
            console.error("Error parsing JSON:", error);
        }
    } else {
        console.error("No data found in localStorage for key:", `htvm_lang_${id}`);
    }
} else {
    console.error("No 'id' found in URL parameters.");
}


allInstFormGithub = localStorage.getItem('allInstFromGithubFIX');

//console.log(allInstFormGithub)
//console.log("=-----------------------------=")
//console.log(argHTVMinstrMORE[0])


let OUTCODE = "";

if (allInstFormGithub)
{
        OUTCODE = compiler(`; you can also use let since we dont need types in js
str var1 := "AZDSFAWE SRFDAWE SRDF SEDXFV"

; loop over all words and display them alongside its index
Loop, Parse, var1, " " {
    print(A_Index)
    print(A_LoopField)
}

; This is a JavaScript programming block. It will stay intact and included in the JS output.
___js start
// The syntax highlighting will change to JavaScript here since this is now JavaScript code only.
console.log("==========================")
___js end

; normal loop that will run 5 times and print its index
Loop, 5 {
    print(A_Index)
}`, allInstFormGithub, "full", "htvm2");
//console.log("==========12")
//console.log(OUTCODE)
//console.log("==========123")
        resetGlobalVarsOfHTVMjs();
}
    let uniqueId = getUrlParam('id') || 'default';
    const fileSystemKey = 'fileSystem_' + uniqueId;
    const lastFileKey = 'lastFile_' + uniqueId;
    const defaultStructure = {
      name: 'root',
      isFolder: true,
      children: [
        { name: 'main.htvm', isFolder: false, content: OUTCODE }
      ]
    };
    function loadFileSystem() {
      const data = localStorage.getItem(fileSystemKey);
      return data ? JSON.parse(data) : defaultStructure;
    }
    let root = loadFileSystem();
    function saveFileSystem() {
      localStorage.setItem(fileSystemKey, JSON.stringify(root));
    }
    function saveLastFile(path) {
      localStorage.setItem(lastFileKey, JSON.stringify(path));
    }
    function loadLastFile() {
      const data = localStorage.getItem(lastFileKey);
      return data ? JSON.parse(data) : null;
    }
    function findPath(node, target, currentPath = []) {
      if (node === target) return currentPath.concat(node.name);
      if (node.isFolder && node.children) {
        for (let child of node.children) {
          let result = findPath(child, target, currentPath.concat(node.name));
          if (result) return result;
        }
      }
      return null;
    }
    function getItemByPath(path, node) {
      if (!path.length) return node;
      if (!node.isFolder || !node.children) return null;
      const nextName = path[0];
      for (let child of node.children) {
        if (child.name === nextName) {
          return getItemByPath(path.slice(1), child);
        }
      }
      return null;
    }

    /* ----------------------------
       System State & Editor Setup
    ----------------------------- */
    
let allKeyWordsSoWeCanSeeProgrammingBlocks = JSON.parse(localStorage.getItem("htvm_lang_" + new URLSearchParams(window.location.search).get('id')));
    


function isLineInAProgrammingBlock(keywordsSoWeCanSeeProgrammingBlocks, userCode) {
    // Get the current line from the editor
    let currentLine = editor.getSelectionRange().start.row;
    
    // Split user code into lines for analysis
    const lines = userCode.split('\n');
    
    // Create a map of language markers from the keywordsSoWeCanSeeProgrammingBlocks array
const languageMarkers = {
    [keywordsSoWeCanSeeProgrammingBlocks[12]]: { end: keywordsSoWeCanSeeProgrammingBlocks[13], lang: "cpp" },
    [keywordsSoWeCanSeeProgrammingBlocks[14]]: { end: keywordsSoWeCanSeeProgrammingBlocks[15], lang: "py" },
    [keywordsSoWeCanSeeProgrammingBlocks[16]]: { end: keywordsSoWeCanSeeProgrammingBlocks[17], lang: "js" },
    [keywordsSoWeCanSeeProgrammingBlocks[18]]: { end: keywordsSoWeCanSeeProgrammingBlocks[19], lang: "go" },
    [keywordsSoWeCanSeeProgrammingBlocks[20]]: { end: keywordsSoWeCanSeeProgrammingBlocks[21], lang: "lua" },
    [keywordsSoWeCanSeeProgrammingBlocks[22]]: { end: keywordsSoWeCanSeeProgrammingBlocks[23], lang: "cs" },
    [keywordsSoWeCanSeeProgrammingBlocks[24]]: { end: keywordsSoWeCanSeeProgrammingBlocks[25], lang: "java" },
    [keywordsSoWeCanSeeProgrammingBlocks[26]]: { end: keywordsSoWeCanSeeProgrammingBlocks[27], lang: "kt" },
    [keywordsSoWeCanSeeProgrammingBlocks[28]]: { end: keywordsSoWeCanSeeProgrammingBlocks[29], lang: "rb" },
    [keywordsSoWeCanSeeProgrammingBlocks[30]]: { end: keywordsSoWeCanSeeProgrammingBlocks[31], lang: "nim" },
    [keywordsSoWeCanSeeProgrammingBlocks[32]]: { end: keywordsSoWeCanSeeProgrammingBlocks[33], lang: "ahk" },
    [keywordsSoWeCanSeeProgrammingBlocks[34]]: { end: keywordsSoWeCanSeeProgrammingBlocks[35], lang: "swift" },
    [keywordsSoWeCanSeeProgrammingBlocks[36]]: { end: keywordsSoWeCanSeeProgrammingBlocks[37], lang: "dart" },
    [keywordsSoWeCanSeeProgrammingBlocks[38]]: { end: keywordsSoWeCanSeeProgrammingBlocks[39], lang: "ts" },
    [keywordsSoWeCanSeeProgrammingBlocks[40]]: { end: keywordsSoWeCanSeeProgrammingBlocks[41], lang: "groovy" }
};

    
    // Find all language blocks
    const detectedBlocks = [];
    let currentBlock = null;
    
    for (let i = 0; i < lines.length; i++) {
        const line = lines[i].trim();
        
        // Check for start markers
        for (const marker in languageMarkers) {
            if (line.includes(marker)) {
                currentBlock = {
                    start: i,
                    lang: languageMarkers[marker].lang,
                    endMarker: languageMarkers[marker].end
                };
                break;
            }
        }
        
        // Check for end marker if we're inside a block
        if (currentBlock && line.includes(currentBlock.endMarker)) {
            detectedBlocks.push({
                start: currentBlock.start,
                end: i,
                lang: currentBlock.lang
            });
            currentBlock = null;
        }
    }
    
    // Check if current line is within any of the detected blocks
    for (const block of detectedBlocks) {
        if (currentLine >= block.start && currentLine <= block.end) {
            return block.lang;
        }
    }
    
    // Not inside any programming block
    return "htvm";
}

    let currentDir = root;
    let dirHistory = [];
    let openFile = null; // currently open file
    let editor = ace.edit("editor");
    
    let langTools = ace.require("ace/ext/language_tools");
  
    
    editor.setTheme("ace/theme/monokai");
    editor.session.setMode("ace/mode/javascript");

    editor.setOptions({
        enableBasicAutocompletion: true,    // Enable basic autocompletion
        enableLiveAutocompletion: true,     // Enable live autocompletion
        enableSnippets: false,              // Disable snippets if not needed
        showPrintMargin: false,             // Hide the print margin
        behavioursEnabled: false            // Disable behavior-based completions like indent
    });
    
    langTools.setCompleters([]);
    langTools.addCompleter(Completer);
    editor.setOptions({ fontSize: "18px" });
    
editor.on("changeSelection", function(delta) {
  if (openFile) {
    let path = findPath(root, openFile);

    let fileExtension = path[1].split('.').pop();
    if (fileExtension == "htvm") {
      let isLineInAprogrammingBlockOUT = isLineInAProgrammingBlock(allKeyWordsSoWeCanSeeProgrammingBlocks, openFile.content);
      //console.log(isLineInAprogrammingBlockOUT);
      if (isLineInAprogrammingBlockOUT) {
        const langMode = fileExtensionToLangName('.' + isLineInAprogrammingBlockOUT);
        editor.session.setMode("ace/mode/" + langMode);
      }
    }

    saveFileSystem();

    if (path) saveLastFile(path);
    updateFilePathDisplay();
  }
});

    editor.on("change", function() {
      if (openFile) {
        openFile.content = editor.getValue();
        saveFileSystem();
        let path = findPath(root, openFile);
        if (path) saveLastFile(path);
        updateFilePathDisplay();
      }
    });


    /* ----------------------------
       File/Folder Operations
    ----------------------------- */
    function createNew(type) {
      const name = prompt(`Enter ${type} name:`);
      if (!name) return;
      if (currentDir.children.some(item => item.name === name)) {
        alert('Name already exists!');
        return;
      }
      let newItem = type === 'file'
        ? { name, isFolder: false, content: '' }
        : { name, isFolder: true, children: [] };
      currentDir.children.push(newItem);
      saveFileSystem();
      renderDirectory();
    }
    function renameItem(item) {
      const newName = prompt("Enter new name:", item.name);
      if (!newName || newName === item.name) return;
      if (currentDir.children.some(child => child.name === newName)) {
        alert('A file or folder with that name already exists!');
        return;
      }
      item.name = newName;
      if (openFile === item) {
        let path = findPath(root, item);
        if (path) saveLastFile(path);
      }
      saveFileSystem();
      renderDirectory();
      updateFilePathDisplay();
    }
    function deleteItem(item) {
      if (!confirm(`Are you sure you want to delete "${item.name}"? This will delete all its contents if it's a folder.`)) {
        return;
      }
      if (openFile === item) {
        openFile = null;
        document.getElementById('editor').style.display = 'none';
        updateFilePathDisplay();
      }
      currentDir.children = currentDir.children.filter(child => child !== item);
      saveFileSystem();
      renderDirectory();
    }


// First, add the fileExtensionToLangName function
function fileExtensionToLangName(extension) {
  // Mapping of file extensions to language names
  const extToLangMap = {
    abap: [".abap"],
    abc: [".abc"],
    actionscript: [".as"],
    ada: [".ada"],
    apache_conf: [".conf"],
    asciidoc: [".adoc", ".asciidoc"],
    assembly_x86: [".asm"],
    autohotkey: [".ahk"],
    batchfile: [".bat"],
    c9search: [".c9"],
    c_cpp: [".c", ".cpp"],
    cirru: [".cirru"],
    clojure: [".clj"],
    cobol: [".cob"],
    coffee: [".coffee"],
    coldfusion: [".cfm"],
    csharp: [".cs"],
    css: [".css"],
    curly: [".curl"],
    d: [".d"],
    dart: [".dart"],
    diff: [".diff", ".patch"],
    dockerfile: ["Dockerfile"],
    dot: [".dot"],
    dummy: [".dummy"],
    dummysyntax: [".dummysyntax"],
    eiffel: [".e"],
    ejs: [".ejs"],
    elixir: [".ex", ".exs"],
    elm: [".elm"],
    erlang: [".erl", ".hrl"],
    forth: [".fs", ".fth"],
    ftl: [".ftl"],
    gcode: [".gcode"],
    gherkin: [".feature"],
    gitignore: [".gitignore"],
    glsl: [".glsl"],
    golang: [".go"],
    groovy: [".groovy"],
    haml: [".haml"],
    handlebars: [".hbs", ".handlebars"],
    haskell: [".hs"],
    haxe: [".hx"],
    html: [".html", ".htm"],
    html_ruby: [".html.erb"],
    ini: [".ini"],
    io: [".io"],
    jack: [".jack"],
    jade: [".jade"],
    java: [".java"],
    javascript: [".js"],
    json: [".json"],
    jsoniq: [".jsoniq"],
    jsp: [".jsp"],
    jsx: [".jsx"],
    julia: [".jl"],
    latex: [".tex"],
    less: [".less"],
    liquid: [".liquid"],
    lisp: [".lisp", ".lsp"],
    livescript: [".ls"],
    logiql: [".logic"],
    lsl: [".lsl"],
    lua: [".lua"],
    luapage: [".lp"],
    lucene: [".lucene"],
    makefile: ["Makefile"],
    markdown: [".md", ".markdown"],
    mask: [".mask"],
    matlab: [".m"],
    mel: [".mel"],
    mushcode: [".mc"],
    mysql: [".sql"],
    nix: [".nix"],
    objectivec: [".m", ".h"],
    ocaml: [".ml", ".mli"],
    pascal: [".pas"],
    perl: [".pl", ".pm"],
    pgsql: [".pgsql"],
    php: [".php"],
    powershell: [".ps1"],
    praat: [".praat"],
    prolog: [".pl"],
    properties: [".properties"],
    protobuf: [".proto"],
    python: [".py"],
    r: [".r"],
    rdoc: [".rdoc"],
    rhtml: [".rhtml"],
    ruby: [".rb"],
    rust: [".rs"],
    sass: [".sass", ".scss"],
    scad: [".scad"],
    scala: [".scala"],
    scheme: [".scm"],
    scss: [".scss"],
    sh: [".sh"],
    sjs: [".sjs"],
    smarty: [".tpl"],
    snippets: [".sublime-snippet"],
    soy_template: [".soy"],
    space: [".space"],
    sql: [".sql"],
    stylus: [".styl"],
    svg: [".svg"],
    tcl: [".tcl"],
    tex: [".tex"],
    text: [".txt"],
    textile: [".textile"],
    toml: [".toml"],
    twig: [".twig"],
    typescript: [".ts"],
    vala: [".vala"],
    vbscript: [".vbs"],
    velocity: [".vm"],
    verilog: [".v"],
    vhdl: [".vhd"],
    xml: [".xml"],
    xquery: [".xq", ".xquery"],
    yaml: [".yaml", ".yml"],
    htvm: [".ht", ".hti", ".htpy", ".hth", ".htvm"]
  };

  // Get the extension with dot
  const dotExt = extension.startsWith('.') ? extension : '.' + extension;
  
  // Normalize the extension to lower case
  const normalizedExt = dotExt.toLowerCase();

  // Loop through the mapping to find the language
  for (const [lang, exts] of Object.entries(extToLangMap)) {
    if (exts.includes(normalizedExt)) {
      return lang; // Return the language if a match is found
    }
  }

  return "text"; // Return text if not found (better default than "ht")
}

// Modify the navigateInto function to use the new language mapping
function navigateInto(item) {
  if (!item.isFolder) {
    if (openFile && openFile !== item) {
      openFile.content = editor.getValue();
    }
    openFile = item;
    editor.setValue(item.content || "", -1);
    
    // Get file extension and set appropriate mode
    const extension = item.name.split('.').pop();
    const langMode = fileExtensionToLangName('.' + extension);
    editor.session.setMode("ace/mode/" + langMode);
    
    document.getElementById('editor').style.display = 'block';
    closeIframe();
    let path = findPath(root, item);
    if (path) saveLastFile(path);
    updateFilePathDisplay();
    return;
  }
  if (openFile) {
    openFile.content = editor.getValue();
  }
  dirHistory.push(currentDir);
  currentDir = item;
  document.getElementById('back-btn').disabled = false;
  renderDirectory();
}
    
    function goBack() {
      if (dirHistory.length === 0) return;
      if (openFile) openFile.content = editor.getValue();
      currentDir = dirHistory.pop();
      document.getElementById('back-btn').disabled = dirHistory.length === 0;
      renderDirectory();
    }
    function renderDirectory() {
      const container = document.getElementById('directory-contents');
      container.innerHTML = '';
      currentDir.children.forEach(item => {
        const div = document.createElement('div');
        div.className = `item ${item.isFolder ? 'folder' : 'file'}`;
        const nameSpan = document.createElement('span');
        nameSpan.className = 'name';
        nameSpan.textContent = item.name;
        nameSpan.onclick = () => navigateInto(item);
        div.appendChild(nameSpan);
        const renameBtn = document.createElement('button');
        renameBtn.textContent = '‚úèÔ∏è';
        renameBtn.title = 'Rename';
        renameBtn.className = 'action-btn';
        renameBtn.onclick = (e) => { e.stopPropagation(); renameItem(item); };
        div.appendChild(renameBtn);
        const deleteBtn = document.createElement('button');
        deleteBtn.textContent = 'üóëÔ∏è';
        deleteBtn.title = 'Delete';
        deleteBtn.className = 'action-btn';
        deleteBtn.onclick = (e) => { e.stopPropagation(); deleteItem(item); };
        div.appendChild(deleteBtn);
        container.appendChild(div);
      });
      document.getElementById('path-display').textContent =
        getFullPath(currentDir).join(' / ');
    }
    function getFullPath(dir) {
      let path = [];
      function traverse(node, target, acc) {
        if (node === target) return true;
        if (node.isFolder && node.children) {
          for (let child of node.children) {
            if (traverse(child, target, acc)) {
              acc.unshift(child.name);
              return true;
            }
          }
        }
        return false;
      }
      traverse(root, dir, path);
      return ['root', ...path];
    }
    function updateFilePathDisplay() {
      const display = document.getElementById('file-path-display');
      if (openFile) {
        let fullPath = findPath(root, openFile);
        display.textContent = "Editing: " + fullPath.join(' / ');
      } else {
        display.textContent = "";
      }
    }


async function fileMakeOrOverride(name, content = "[empty file]") {

  // Check if the file already exists in the current directory
  let existingFile = currentDir.children.find(item => item.name === name && !item.isFolder);

  if (existingFile) {
    // If the file exists, override its content
    existingFile.content = content;
    //alert(`File "${name}" has been updated.`);
  } else {
    // If the file doesn't exist, create a new file
    let newFile = { name, isFolder: false, content };
    currentDir.children.push(newFile);
    //alert(`File "${name}" has been created.`);
  }

  // Save the file system and re-render the directory
  saveFileSystem();
  renderDirectory();
}

    /* ----------------------------
       Console
    ----------------------------- */

    function logToConsole(message) {
      const logDiv = document.getElementById("console-log");
      logDiv.innerHTML += message + "<br>";
    }



    /* ----------------------------
       HTVM
    ----------------------------- */

async function runHTVM(fileContents, fileName) {

    // Get the URL id parameter
    const urlParams = new URLSearchParams(window.location.search);
    const id = urlParams.get('id') || 'default_id'; // Use 'default_id' if 'id' is not in the URL

    // Build the localStorage key based on the id
    const storageKey = `htvm_lang_${id}`;

    // Fetch the stored data from localStorage
    let storedData = localStorage.getItem(storageKey);

    // If there's no stored data, fetch it from the GitHub file
    if (!storedData) {
        fetch('https://raw.githubusercontent.com/TheMaster1127/HTVM/refs/heads/main/HTVM-instructions.txt')
            .then(response => response.text())
            .then(data => {
                // Split the data into lines
                const lines = data.split('\n');
                // Get the first 162 lines
                const first162Lines = lines.slice(0, 162);

                // Store the array in localStorage
                localStorage.setItem(storageKey, JSON.stringify(first162Lines));
                //console.log(`First 162 lines have been stored in localStorage as "${storageKey}".`);

                // Call the function again with the fetched data
                runHTVM(fileContents, fileName);
            })
            .catch(error => console.error('Error fetching the file:', error));
    } else {
        // If stored data exists, parse it
        storedData = JSON.parse(storedData);

        // Convert the array of lines into a single string with newlines
        const linesString = storedData.join('\n');

        // Concatenate everything into htvm_instr with a newline between the two parts
        const htvm_instr = linesString + '\n' + (build_in_funcs || '');

        // Now you have the full instruction string in htvm_instr
        OUTCODE = "";
        OUTCODE = compiler(fileContents, htvm_instr, "full", "js");

        resetGlobalVarsOfHTVMjs();

        // Replace the extension with '.js'
        fileName = fileName.replace(/\.[^/.]+$/, ".js");

        // Call fileMakeOrOverride to save the output
        fileMakeOrOverride(fileName, OUTCODE);
        
logToConsole(`Saved the HTVM output to: ${fileName} at: ${new Date().toLocaleTimeString("en-GB", { hour12: false, hour: "2-digit", minute: "2-digit", second: "2-digit" })}.${new Date().getMilliseconds().toString().padStart(3, "0")}`);




        
        if (runJsAfterHTVM) {
            const consoleDiv = document.getElementById("console-log");
            consoleDiv.innerHTML = ""; // Clear previous logs
            console.clear();
            closeIframe(); // Close the iframe if applicable
            
logToConsole(`Saved the HTVM output to: ${fileName} at: ${new Date().toLocaleTimeString("en-GB", { hour12: false, hour: "2-digit", minute: "2-digit", second: "2-digit" })}.${new Date().getMilliseconds().toString().padStart(3, "0")}`);




            logToConsole("Running HTVM output...");
            logToConsole("\n");

            // Redirect console.log to also log in the browser
            
            const originalLog = console.log;
            console.log = function(...args) {
                originalLog.apply(console, args);
                consoleDiv.innerHTML += args.join(" ") + "<br>";
            };

            try {
                new Function(OUTCODE)(); // Execute the generated JS code
            } catch (e) {
                console.log("Error: " + e.message);
            }

            // Restore console.log after running the code
            setTimeout(() => { console.log = originalLog; }, 1000);
        }
    }
}




let originalLog = console.log; // Save the original console.log function

// Function to reset the console and clear previous logs
function resetConsole() {
    console.clear();  // Clear the browser's console
    document.getElementById("console-log").innerHTML = "";  // Clear the custom output div
    console.log = originalLog;  // Restore the original console.log function
}



    /* ----------------------------
       Run File Functionality
    ----------------------------- */
    function runFile() {
        resetConsole();
      if (!openFile) {
        alert("No file open to run!");
        return;
      }
      const filename = openFile.name;
      const consoleDiv = document.getElementById("console-log");
      consoleDiv.innerHTML = "";
      closeIframe();
      if (filename.endsWith(".js")) {
        const consoleDiv = document.getElementById("console-log");
        consoleDiv.innerHTML = ""; // Clears the log
        console.clear();
        
        const originalLog = console.log;
        console.log = function(...args) {
          originalLog.apply(console, args);
          consoleDiv.innerHTML += args.join(" ") + "<br>";
        };
        try {
          new Function(openFile.content)();
        } catch (e) {
          console.log("Error: " + e.message);
        }
        setTimeout(() => { console.log = originalLog; }, 1000);
      }
      else if (filename.endsWith(".htvm")) {
        //console.log("themaster1127 will make and call a func here to handle .htvm files!!!");
        runHTVM(openFile.content, filename);
        OUTCODE = "";
      }
      else if (filename.endsWith(".html")) {
        document.getElementById("output-container").style.display = "flex";
        document.getElementById("vertical-splitter").style.display = "block";
        const iframe = document.createElement("iframe");
        iframe.id = "html-output";
        iframe.srcdoc = openFile.content;
        const outputContainer = document.getElementById("output-container");
        outputContainer.insertBefore(iframe, outputContainer.firstChild);
      }
      else {
        alert("File type not supported for execution.");
      }
    }
    function closeIframe() {
      document.getElementById("output-container").style.display = "none";
      document.getElementById("vertical-splitter").style.display = "none";
      document.getElementById("output-container").innerHTML = "";

    }

    /* ----------------------------
       Clear Console Functionality
    ----------------------------- */
    function clearConsole() {
      document.getElementById("console-log").innerHTML = "";
    }

    /* ----------------------------
       Resizable Splitters
    ----------------------------- */
    // Sidebar splitter
    const sidebarSplitter = document.getElementById("sidebar-splitter");
    sidebarSplitter.addEventListener("mousedown", initSidebarResize);
    function initSidebarResize(e) {
      window.addEventListener("mousemove", resizeSidebar);
      window.addEventListener("mouseup", stopSidebarResize);
    }
    function resizeSidebar(e) {
      let newWidth = e.clientX;
      if (newWidth < 150) newWidth = 150;
      if (newWidth > 400) newWidth = 400;
      document.getElementById("sidebar").style.width = newWidth + "px";
    }
    function stopSidebarResize(e) {
      window.removeEventListener("mousemove", resizeSidebar);
      window.removeEventListener("mouseup", stopSidebarResize);
    }
    // Horizontal splitter within IDE (between editor and console)
    const ideHorizontalSplitter = document.getElementById("ide-horizontal-splitter");
    ideHorizontalSplitter.addEventListener("mousedown", initIdeHorizontalResize);
    function initIdeHorizontalResize(e) {
      window.addEventListener("mousemove", resizeIdeHorizontal);
      window.addEventListener("mouseup", stopIdeHorizontalResize);
    }
    function resizeIdeHorizontal(e) {
      const ideRect = document.getElementById("ide-container").getBoundingClientRect();
      let offset = e.clientY - ideRect.top - document.getElementById("buttons-container").offsetHeight;
      if (offset < 50) offset = 50;
      if (offset > ideRect.height - 50) offset = ideRect.height - 50;
      document.getElementById("editor").style.height = offset + "px";
    }
    function stopIdeHorizontalResize(e) {
      window.removeEventListener("mousemove", resizeIdeHorizontal);
      window.removeEventListener("mouseup", stopIdeHorizontalResize);
    }
    // Vertical splitter between IDE and Output
    const verticalSplitter = document.getElementById("vertical-splitter");
    verticalSplitter.addEventListener("mousedown", initVerticalResize);
    function initVerticalResize(e) {
      window.addEventListener("mousemove", resizeVertical);
      window.addEventListener("mouseup", stopVerticalResize);
    }
    function resizeVertical(e) {
      const mainRect = document.getElementById("main-content").getBoundingClientRect();
      let offset = e.clientX - mainRect.left;
      if (offset < 100) offset = 100;
      if (offset > mainRect.width - 100) offset = mainRect.width - 100;
      document.getElementById("ide-container").style.width = offset + "px";
    }
    function stopVerticalResize(e) {
      window.removeEventListener("mousemove", resizeVertical);
      window.removeEventListener("mouseup", stopVerticalResize);
    }

    /* ----------------------------
       Initialization & Keyboard Shortcut
    ----------------------------- */
    renderDirectory();
    const lastFilePath = loadLastFile();
    if (lastFilePath) {
      const pathWithoutRoot = lastFilePath[0] === 'root' ? lastFilePath.slice(1) : lastFilePath;
      const file = getItemByPath(pathWithoutRoot, root);
      if (file && !file.isFolder) {
        openFile = file;
        editor.setValue(file.content || "", -1);
        document.getElementById('editor').style.display = 'block';
        updateFilePathDisplay();
      }
    }
    document.addEventListener("keydown", function(e) {
      if (e.ctrlKey && e.key === "Enter") {
        e.preventDefault();
        runFile();
      }
    });
    
    
function resetGlobalVarsOfHTVMjs()
{

str0 = "nothing";
str00 = "nothing";
str1 = "";
str2 = "";
str3 = "";
str4 = "";
str5 = "";
str6 = "";
str7 = "";
str8 = "";
str9 = "";
str10 = "";
str11 = "";
str12 = "";
str13 = "";
str14 = "";
str15 = "";
str16 = "";
str17 = "";
str18 = "";
str19 = "";
str20 = "";
str21 = "";
int0 = 0;
int1 = 0;
int2 = 0;
int3 = 0;
int4 = 0;
int5 = 0;
int6 = 0;
int7 = 0;
argHTVMinstrMORE = [];
isNotHTVMfileEXTRA_INT = 0;
isNotHTVMfile2 = 0;
isNotHTVMfileEXTRA_LIB_INFO = "";
isNotHTVMfileEXTRA_FUNCS_INFO = "";
programmingBlock_InTheTranspiledLang = [];
programmingBlock_CPP = [];
programmingBlock_PY = [];
programmingBlock_JS = [];
programmingBlock_GO = [];
programmingBlock_LUA = [];
programmingBlock_CS = [];
programmingBlock_JAVA = [];
programmingBlock_KT = [];
programmingBlock_RB = [];
programmingBlock_NIM = [];
programmingBlock_AHK = [];
programmingBlock_SWIFT = [];
programmingBlock_DART = [];
programmingBlock_TS = [];
programmingBlock_GROOVY = [];
programmingBlock_HTVM = [];
programmingBlock_HTVMsyntax = [];
fullLangAllOperators = [];
fullLangAllOperators_HELP = [];
fixExpertionLineFuncOnly = 0;
langToConvertTo = "";
langFileExtension = "";
commands = "";
keyWordAlliance = "";
keyWordCrew = "";
keyWordProc = "";
keyWordStruct = "";
keyWordPorp = "";
keyWordThis = "";
keyWordInclude = "";
keyWordCodeInTheTranspiledLangStart = "";
keyWordCodeInTheTranspiledLangEnd = "";
keyWordCodeInTheTranspiledLangStartCPP = "";
keyWordCodeInTheTranspiledLangEndCPP = "";
keyWordCodeInTheTranspiledLangStartPY = "";
keyWordCodeInTheTranspiledLangEndPY = "";
keyWordCodeInTheTranspiledLangStartJS = "";
keyWordCodeInTheTranspiledLangEndJS = "";
keyWordCodeInTheTranspiledLangStartGO = "";
keyWordCodeInTheTranspiledLangEndGO = "";
keyWordCodeInTheTranspiledLangStartLUA = "";
keyWordCodeInTheTranspiledLangEndLUA = "";
keyWordCodeInTheTranspiledLangStartCS = "";
keyWordCodeInTheTranspiledLangEndCS = "";
keyWordCodeInTheTranspiledLangStartJAVA = "";
keyWordCodeInTheTranspiledLangEndJAVA = "";
keyWordCodeInTheTranspiledLangStartKT = "";
keyWordCodeInTheTranspiledLangEndKT = "";
keyWordCodeInTheTranspiledLangStartRB = "";
keyWordCodeInTheTranspiledLangEndRB = "";
keyWordCodeInTheTranspiledLangStartNIM = "";
keyWordCodeInTheTranspiledLangEndNIM = "";
keyWordCodeInTheTranspiledLangStartAHK = "";
keyWordCodeInTheTranspiledLangEndAHK = "";
keyWordCodeInTheTranspiledLangStartSWIFT = "";
keyWordCodeInTheTranspiledLangEndSWIFT = "";
keyWordCodeInTheTranspiledLangStartDART = "";
keyWordCodeInTheTranspiledLangEndDART = "";
keyWordCodeInTheTranspiledLangStartTS = "";
keyWordCodeInTheTranspiledLangEndTS = "";
keyWordCodeInTheTranspiledLangStartGROOVY = "";
keyWordCodeInTheTranspiledLangEndGROOVY = "";
keyWordCodeInTheTranspiledLangStartHTVM = "";
keyWordCodeInTheTranspiledLangEndHTVM = "";
keyWordCodeInHTVMstart = "";
keyWordCodeInHTVMend = "";
keyWordCurlyBraceOpen = "";
keyWordCurlyBraceClose = "";
keyWordNull = "";
keyWordTrue = "";
keyWordFalse = "";
keyWordVoid = "";
keyWordDouble = "";
keyWordChar = "";
keyWordUint8 = "";
keyWordUint16 = "";
keyWordUint32 = "";
keyWordUint64 = "";
keyWordINT = "";
keyWordSTR = "";
keyWordBOOL = "";
keyWordFLOAT = "";
keyWordINT8 = "";
keyWordINT16 = "";
keyWordINT32 = "";
keyWordINT64 = "";
keyWordIF = "";
keyWordElseIf = "";
keyWordElse = "";
keyWordWhileLoop = "";
keyWordLoopInfinite = "";
keyWordLoop = "";
keyWordLoopParse = "";
keyWordContinue = "";
keyWordBreak = "";
keyWordFunc = "";
keyWordAwait = "";
keyWordAsync = "";
keyWordThrow = "";
keyWordErrorMsg = "";
keyWordTry = "";
keyWordCatch = "";
keyWordFinally = "";
keyWordReturnStatement = "";
keyWordArrayAppend = "";
keyWordArrayPop = "";
keyWordArraySize = "";
keyWordArrayInsert = "";
keyWordArrayRemove = "";
keyWordArrayIndexOf = "";
keyWordArrayDefinition = "";
keyWordArrayOfIntegersDefinition = "";
keyWordArrayOfStringsDefinition = "";
keyWordArrayOfFloatingPointNumbersDefinition = "";
keyWordArrayOfBooleansDefinition = "";
keyWordVar = "";
keyWordLet = "";
keyWordConst = "";
keyWordEnd = "";
keyWordGlobal = "";
keyWordComment = "";
keyWordCommentOpenMultiLine = "";
keyWordCommentCloseMultiLine = "";
keyWordEscpaeChar = "";
keyWordMainLabel = "";
keyWordConcat = "";
keyWordAdd = "";
keyWordSub = "";
keyWordMul = "";
keyWordDiv = "";
keyWordMod = "";
keyWordExp = "";
keyWordEqual = "";
keyWordStrictEqual = "";
keyWordNotEqual = "";
keyWordGreater = "";
keyWordLess = "";
keyWordGreaterEqual = "";
keyWordLessEqual = "";
keyWordAnd = "";
keyWordOr = "";
keyWordNot = "";
keyWordBitAnd = "";
keyWordBitOr = "";
keyWordBitXor = "";
keyWordBitNot = "";
keyWordShiftLeft = "";
keyWordShiftRight = "";
keyWordShiftUnsignedRight = "";
keyWordAssign = "";
keyWordAssignAdd = "";
keyWordAssignConcat = "";
keyWordAssignSub = "";
keyWordAssignMul = "";
keyWordAssignDiv = "";
keyWordAssignMod = "";
keyWordAssignShiftLeft = "";
keyWordAssignShiftRight = "";
keyWordLogicalAssignShiftRight = "";
keyWordAssignBitAnd = "";
keyWordAssignBitOr = "";
keyWordAssignBitXor = "";
keyWordTernary1 = "";
keyWordTernary2 = "";
keyWordInc = "";
keyWordDec = "";
AHKlikeLoopsIndexedAt = "";
keyWordAIndex = "";
keyWordALoopField = "";
useFuncKeyWord = "";
useCurlyBraces = "";
useEnd = "";
useSemicolon = "";
theSemicolon = "";
theColon = "";
useParentheses = "";
usePrefixTypeForTypeDefinition = "";
usePostfixTypeForTypeDefinition = "";
usePythonicColonSyntax = "";
useCurlyBracesSyntaxForArrayDef = "";
useInJavaScriptAlwaysUseVar = "";
useJavaScriptInAfullHTMLfile = "";
useJavaScriptAmainFuncDef = "";
useJavaScriptAllFuncsAreAsync = "";
useJavaScriptAlwaysTripleEqual = "";
langToConvertTo_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
langFileExtension_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
commands_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordAlliance_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordCrew_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordProc_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordStruct_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordPorp_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordThis_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordInclude_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordCodeInTheTranspiledLangStart_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordCodeInTheTranspiledLangEnd_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordCodeInTheTranspiledLangStartCPP_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordCodeInTheTranspiledLangEndCPP_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordCodeInTheTranspiledLangStartPY_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordCodeInTheTranspiledLangEndPY_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordCodeInTheTranspiledLangStartJS_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordCodeInTheTranspiledLangEndJS_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordCodeInTheTranspiledLangStartGO_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordCodeInTheTranspiledLangEndGO_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordCodeInTheTranspiledLangStartLUA_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordCodeInTheTranspiledLangEndLUA_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordCodeInTheTranspiledLangStartCS_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordCodeInTheTranspiledLangEndCS_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordCodeInTheTranspiledLangStartJAVA_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordCodeInTheTranspiledLangEndJAVA_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordCodeInTheTranspiledLangStartKT_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordCodeInTheTranspiledLangEndKT_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordCodeInTheTranspiledLangStartRB_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordCodeInTheTranspiledLangEndRB_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordCodeInTheTranspiledLangStartNIM_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordCodeInTheTranspiledLangEndNIM_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordCodeInTheTranspiledLangStartAHK_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordCodeInTheTranspiledLangEndAHK_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordCodeInTheTranspiledLangStartSWIFT_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordCodeInTheTranspiledLangEndSWIFT_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordCodeInTheTranspiledLangStartDART_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordCodeInTheTranspiledLangEndDART_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordCodeInTheTranspiledLangStartTS_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordCodeInTheTranspiledLangEndTS_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordCodeInTheTranspiledLangStartGROOVY_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordCodeInTheTranspiledLangEndGROOVY_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordCodeInTheTranspiledLangStartHTVM_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordCodeInTheTranspiledLangEndHTVM_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordCodeInHTVMstart_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordCodeInHTVMend_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordCurlyBraceOpen_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordCurlyBraceClose_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordNull_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordTrue_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordFalse_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordVoid_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordDouble_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordChar_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordUint8_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordUint16_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordUint32_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordUint64_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordINT_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordSTR_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordBOOL_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordFLOAT_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordINT8_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordINT16_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordINT32_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordINT64_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordIF_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordElseIf_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordElse_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordWhileLoop_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordLoopInfinite_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordLoop_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordLoopParse_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordContinue_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordBreak_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordFunc_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordAwait_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordAsync_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordThrow_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordErrorMsg_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordTry_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordCatch_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordFinally_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordReturnStatement_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordArrayAppend_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordArrayPop_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordArraySize_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordArrayInsert_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordArrayRemove_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordArrayIndexOf_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordArrayDefinition_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordArrayOfIntegersDefinition_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordArrayOfStringsDefinition_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordArrayOfFloatingPointNumbersDefinition_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordArrayOfBooleansDefinition_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordVar_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordLet_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordConst_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordEnd_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordGlobal_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordComment_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordCommentOpenMultiLine_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordCommentCloseMultiLine_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordEscpaeChar_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordMainLabel_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordConcat_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordAdd_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordSub_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordMul_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordDiv_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordMod_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordExp_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordEqual_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordStrictEqual_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordNotEqual_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordGreater_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordLess_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordGreaterEqual_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordLessEqual_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordAnd_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordOr_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordNot_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordBitAnd_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordBitOr_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordBitXor_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordBitNot_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordShiftLeft_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordShiftRight_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordShiftUnsignedRight_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordAssign_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordAssignAdd_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordAssignConcat_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordAssignSub_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordAssignMul_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordAssignDiv_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordAssignMod_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordAssignShiftLeft_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordAssignShiftRight_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordLogicalAssignShiftRight_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordAssignBitAnd_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordAssignBitOr_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordAssignBitXor_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordTernary1_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordTernary2_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordInc_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordDec_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
AHKlikeLoopsIndexedAt_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordAIndex_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordALoopField_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
useCurlyBraces_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
useEnd_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
useSemicolon_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
useParentheses_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
usePrefixTypeForTypeDefinition_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
usePostfixTypeForTypeDefinition_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
usePythonicColonSyntax_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
useCurlyBracesSyntaxForArrayDef_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
useInJavaScriptAlwaysUseVar_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
useJavaScriptInAfullHTMLfile_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
useJavaScriptAmainFuncDef_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
useJavaScriptAllFuncsAreAsync_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
useJavaScriptAlwaysTripleEqual_2 = "awesdgfd-awesrs-awedsfd-aesdg-sc-zsdxfvc-sdfd";
keyWordALoopFieldOriginal = "";
keyWordAIndexOriginal = "";
out_KeyWordsCommands = "";
outTrimCode = "";
htCode = "";
outVarOperator = "";
lineDone = 0;
areWeInAFuncFromInstructions = 0;
areWeInAFuncFromInstructionsLineNum = 0;
javaMainFuncSeen = 0;
csMainFuncSeen = 0;
howMany_fixAindexInGoUnused = 0;
luaContinueFix_Num = 0;
theTryCatchVarForErrors = "jhku-dfsds-ds-d-ffdsf-sdfsfdsedsf";
allVarsSoWeDontReDecVars = [];
allVarsSoWeDontReDecVars_FIX_uint8 = [];
allVarsSoWeDontReDecVars_FIX_uint16 = [];
allVarsSoWeDontReDecVars_FIX_uint32 = [];
allVarsSoWeDontReDecVars_FIX_uint64 = [];
allVarsSoWeDontReDecVars_FIX_int64 = [];
allVarsSoWeDontReDecVars_FIX_float = [];
allVarsSoWeDontReDecVars_FIX_TOGGLE = 0;

   
}
    
// Get the current file path from the file-path-display element
const filePath = document.getElementById('file-path-display').textContent.trim(); // Trim any extra spaces

// Extract the file name from the path
const fileName = filePath.split('/').pop().trim(); // Trim the file name as well

// Find all file name elements
const fileNameElements = [...document.querySelectorAll('.item.file .name')];

// Try to find the matching file name
const fileNameElement = fileNameElements.find(span => span.textContent.trim() === fileName); // Trim for comparison

// Click the found file or the first file if not found
if (fileNameElement) {
    fileNameElement.click();
} else if (fileNameElements.length > 0) {
    fileNameElements[0].click(); // Click the first file in the list
    console.log(`File "${fileName}" not found. Opened the first file instead.`);
} else {
    console.log(`No files found.`);
}


// Apply CSS styles for the editor
    
var css = `
    .ace-monokai .ace_marker-layer .ace_active-line {
      background-color: #103010 !important;
    }
    
    .ace-monokai {
      background-color: #050505 !important;
      color: #f8f8f2;
    }
    
    .ace-monokai .ace_gutter {
      background: #204020 !important;
      color: #cbcdc3 !important;
    }
    
    .ace-monokai .ace_gutter-active-line {
      background-color: transparent !important;
    }
    
    .ace-monokai .ace_entity.ace_name.ace_tag,
    .ace-monokai .ace_keyword,
    .ace-monokai .ace_meta.ace_tag,
    .ace-monokai .ace_storage {
      color: #40a0e0 !important;
    }
    
    .ace-monokai .ace_entity.ace_name.ace_function,
    .ace-monokai .ace_entity.ace_other,
    .ace-monokai .ace_entity.ace_other.ace_attribute-name,
    .ace-monokai .ace_variable {
      color: #ff80df !important;
    }
    
    .ace-monokai .ace_comment {
      color: #40d080 !important;
      font-weight: line-through !important;
    }
    
    .ace-monokai .ace_commentOpen_Close {
      color: #40d080 !important;
      font-weight: line-through !important;
    }
    
    .ace-monokai .ace_variables {
      color: #ffffff !important;
    }
    
    .ace-monokai .ace_functions {
      color: #80dfff !important;
    }
    
    .ace-monokai .ace_keyword {
    color: #8080e0 !important; /* Customize color as needed */
    font-weight: bold !important;
    }
    .ace-monokai .ace_braces_Open {
      color: #FFFFff !important;
    }
    
    .ace-monokai .ace_braces_Close {
      color: #FFFFff !important;
    }
    
    .ace-monokai .ace_arrayMethods {
      color: #FAB820 !important;
    }
    
    .ace-monokai .ace_BuildInFunc {
      color: #ff80df !important;
    }
    
    .ace-monokai .ace_command {
      color: #40a0e0 !important;
      font-weight: bold !important;
    }
    
    .ace-monokai .ace_static_types {
      color: #569cd6 !important;
      font-weight: bold !important;
    }
    
    .ace-monokai .ace_string {
      color: #ffa0a0 !important;
      font-weight: lighter !important;
    }
    
    .ace-monokai .ace_operators {
      color: #00ffff !important;
      font-weight: lighter !important;
    }
    
    
    .ace-monokai .ace_trueANDfalse {
      color: #00ffff !important;
      font-weight: lighter !important;
    }
    
    .ace-monokai .ace_escape-char {
      color: #ff8000 !important;
      font-weight: bold !important;
    }

    .ace-monokai .ace_programmingBlocksAndImport {
      color: #F0401C !important;
      font-weight: bold !important;
    }
    
    .ace-monokai .ace_punctuation,
    .ace-monokai .ace_punctuation.ace _tag {
      color: #ffa0a0 !important;
    }
    
    *::-webkit-scrollbar {
      width: 1em;
    }
    
    *::-webkit-scrollbar-track {
      box-shadow: inset 0 0 6px rgba(0, 0, 0, 0.3);
    }
    
    *::-webkit-scrollbar-thumb {
      background-color: darkgrey;
      outline: 1px solid slategrey;
    }
`;

var style = document.createElement("style");
style.type = "text/css";
if (style.styleSheet) {
  style.styleSheet.cssText = css;
} else {
  style.appendChild(document.createTextNode(css));
}
document.head.appendChild(style);

let intervalId = setInterval(() => {
    let editor = document.querySelector('.ace_editor.ace_autocomplete.ace-monokai.ace_dark');
    
    if (editor) {
        editor.style.fontSize = '13px'; // Apply the font size change
        clearInterval(intervalId); // Stop the loop after the change
    }
}, 100); // Check every 100ms






// htvm_ide_reload_fix: Check if the 'htvm_ide_reload_fix' key exists in localStorage
let reloadCount = parseInt(localStorage.getItem('htvm_ide_reload_fix') || '0');

async function reloadPage() {
    if (reloadCount === 0) {
        // First reload: Set the reload count to 1
        localStorage.setItem('htvm_ide_reload_fix', '2');
        // Force a hard reload by setting a flag in sessionStorage
        sessionStorage.setItem('htvm_ide_hard_reload', 'true');
        
        console.log("Waiting before first reload...");
        await sleep(400); // Add a 1 second delay before the first reload
        
        window.location.reload();  // First reload
    }
}

// Call the reloadPage function
reloadPage();



  </script>
</body>
</html>

